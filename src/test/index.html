<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        var str = `
        var hq_str_sh000001="上证指数,3216.0118,3214.5027,3203.9393,3229.1766,3196.4553,0,0,316273649,363964468654,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2022-03-29,15:01:09,00,";
var hq_str_int_nasdaq="纳斯达克,14354.90,185.60,1.31";
var hq_str_hk00700="TENCENT,腾讯控股,371.000,366.400,380.400,370.000,377.200,10.800,2.948,377.00000,377.20001,7860991814,20901992,0.000,0.000,658.000,297.000,2022/03/29,16:08";
var hq_str_sz000665="湖北广电,9.560,8.760,8.990,9.560,8.770,8.990,9.000,317745385,2932012153.110,223500,8.990,1277465,8.980,44600,8.970,59600,8.960,393400,8.950,943559,9.000,160900,9.010,117800,9.020,203500,9.030,50100,9.040,2022-03-29,15:00:03,00";
var hq_str_gb_baba="阿里巴巴,115.0900,1.86,2022-03-29 17:08:04,2.1000,113.8600,116.2300,111.9200,245.6900,73.2800,30167955,76758484,311999051978,3.76,30.610000,0.00,0.00,0.00,0.00,2710913650,40,115.8900,0.70,0.80,Mar 29 05:08AM EDT,Mar 28 04:01PM EDT,112.9900,32397,1,2022,3448637841.8231,115.9500,115.3000,3750380.4000,115.8900";
var hq_str_int_ftse="伦敦指数,7538.34,65.20,0.87";
var hq_str_b_TWSE="台湾台北指数,17548.66,28.65,0.16,1:49 AM,13:49:00";
var hq_str_int_hangseng="恒生指数,21927.63,242.66,1.12";
var hq_str_sz399006="创业板指,2603.425,2594.128,2592.666,2633.449,2581.379,0.000,0.000,10998233760,180266254155.430,0,0.000,0,0.000,0,0.000,0,0.000,0,0.000,0,0.000,0,0.000,0,0.000,0,0.000,0,0.000,2022-03-29,15:00:03,00";

`;

        // 保留 2 位小数
        function saveDecimal(num, n = 2) {
            const str = num.toString();
            if (str.split('.').length > 1) {
                return (`${str.split('.')[0]}.${str.split('.')[1].substring(0,n).padEnd(n,0)}`);
            } else {
                return (`${str.split('.')[0]}.${''.padEnd(n,0)}`);
            }
        };

        // 正负符号
        function setPlusOrMinusTag(num) {
            if (Number(num) > 0) {
                return `+${num}`;
            } else {
                return num;
            }
        }

        function stockInfoFormat(str) {
            const arr = [];
            const arr1 = str.split('var hq_str_');
            for (let item of arr1) {
                const aStockInfo = item.split('=');
                if (aStockInfo[1]) {
                    const aStockDetail = aStockInfo[1].replace(/"/g, '').replace(/;/g, '').split(',').map((
                        item) => {
                        return item.replace('\n', '');
                    });
                    if (aStockInfo[0].includes('sh') || aStockInfo[0].includes('sz')) {
                        // 沪/深
                        const json = {
                            '代码': aStockInfo[0].match(/\d+/g)[0],
                            '名称': aStockDetail[0],
                            '今开': saveDecimal(aStockDetail[1]),
                            '昨收': saveDecimal(aStockDetail[2]),
                            '最高': saveDecimal(aStockDetail[4]),
                            '最低': saveDecimal(aStockDetail[5]),
                            '现价': saveDecimal(aStockDetail[3]),
                            '涨跌': setPlusOrMinusTag(saveDecimal((aStockDetail[3] - aStockDetail[2]))),
                            '涨跌比': setPlusOrMinusTag(saveDecimal((1 - aStockDetail[2] / aStockDetail[3]) *
                                100)),
                        };
                        arr.push(json);
                    } else if (aStockInfo[0].includes('hk')) {
                        // 港
                        const json = {
                            '代码': aStockInfo[0].match(/\d+/g)[0],
                            '名称': aStockDetail[1],
                            '今开': saveDecimal(aStockDetail[2]),
                            '昨收': saveDecimal(aStockDetail[3]),
                            '最高': saveDecimal(aStockDetail[4]),
                            '最低': saveDecimal(aStockDetail[5]),
                            '现价': saveDecimal(aStockDetail[6]),
                            '涨跌': setPlusOrMinusTag(saveDecimal((aStockDetail[6] - aStockDetail[3]))),
                            '涨跌比': setPlusOrMinusTag(saveDecimal((1 - aStockDetail[3] / aStockDetail[6]) *
                                100))
                        };
                        arr.push(json);
                    } else if (aStockInfo[0].includes('gb')) {
                        // 美
                        const json = {
                            '代码': aStockInfo[0].split('_')[1],
                            '名称': aStockDetail[0],
                            '今开': saveDecimal(aStockDetail[5]),
                            '昨收': saveDecimal(aStockDetail[26]),
                            '最高': saveDecimal(aStockDetail[6]),
                            '最低': saveDecimal(aStockDetail[7]),
                            '现价': saveDecimal(aStockDetail[1]),
                            '涨跌': setPlusOrMinusTag(saveDecimal(aStockDetail[4])),
                            '涨跌比': setPlusOrMinusTag(aStockDetail[2]),
                        };
                        arr.push(json);
                    } else {
                        // 其他
                        const json = {
                            '代码': aStockInfo[0].split('_')[1],
                            '名称': aStockDetail[0],
                            '今开': '',
                            '昨收': '',
                            '最高': '',
                            '最低': '',
                            '现价': saveDecimal(aStockDetail[1]),
                            '涨跌': setPlusOrMinusTag(saveDecimal(aStockDetail[2])),
                            '涨跌比': setPlusOrMinusTag(aStockDetail[3]),
                        };
                        arr.push(json);
                    }
                }
            }
            return arr;
        }

        console.table(stockInfoFormat(str));
    </script>
</body>

</html>